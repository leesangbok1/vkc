#!/usr/bin/env node

/**
 * ÏÑ±Îä• ÏµúÏ†ÅÌôî Î∞è Î™®ÎãàÌÑ∞ÎßÅ Ïä§ÌÅ¨Î¶ΩÌä∏
 * Lighthouse, Web Vitals, Bundle Analyzer Ï¢ÖÌï© ÏÑ±Îä• Í≤ÄÏÇ¨
 */

const { chromium } = require('playwright');
const lighthouse = require('lighthouse');
const fs = require('fs');
const path = require('path');

// ÏÑ±Îä• Í≤ÄÏÇ¨ ÎåÄÏÉÅ ÌéòÏù¥ÏßÄ
const PERFORMANCE_PAGES = [
  {
    name: 'HomePage',
    url: 'http://localhost:3000',
    description: 'Î©îÏù∏ ÌéòÏù¥ÏßÄ',
    critical: true
  },
  {
    name: 'QuestionsPage',
    url: 'http://localhost:3000/questions',
    description: 'ÏßàÎ¨∏ Î™©Î°ù ÌéòÏù¥ÏßÄ',
    critical: true
  },
  {
    name: 'QuestionDetailPage',
    url: 'http://localhost:3000/questions/1',
    description: 'ÏßàÎ¨∏ ÏÉÅÏÑ∏ ÌéòÏù¥ÏßÄ',
    critical: true
  },
  {
    name: 'ProfilePage',
    url: 'http://localhost:3000/profile',
    description: 'ÌîÑÎ°úÌïÑ ÌéòÏù¥ÏßÄ',
    critical: false
  }
];

// ÏÑ±Îä• Î™©Ìëú Í∏∞Ï§Ä (Week 3 Î™©Ìëú)
const PERFORMANCE_TARGETS = {
  lighthouse: {
    performance: 90,      // Lighthouse ÏÑ±Îä• Ï†êÏàò
    accessibility: 95,    // Ï†ëÍ∑ºÏÑ± Ï†êÏàò
    bestPractices: 90,    // Î™®Î≤î ÏÇ¨Î°Ä Ï†êÏàò
    seo: 85              // SEO Ï†êÏàò
  },
  webVitals: {
    LCP: 2500,           // Largest Contentful Paint (ms)
    FID: 100,            // First Input Delay (ms)
    CLS: 0.1,            // Cumulative Layout Shift
    FCP: 1800,           // First Contentful Paint (ms)
    TTI: 3500            // Time to Interactive (ms)
  },
  pageLoad: {
    domContentLoaded: 2000,  // DOM Î°úÎî© ÏãúÍ∞Ñ (ms)
    loadComplete: 3000,      // Ï†ÑÏ≤¥ Î°úÎî© ÏãúÍ∞Ñ (ms)
    firstByte: 800          // TTFB (ms)
  }
};

class PerformanceAuditor {
  constructor() {
    this.results = {
      timestamp: new Date().toISOString(),
      summary: {
        totalPages: PERFORMANCE_PAGES.length,
        passedPages: 0,
        failedPages: 0,
        averageLighthouseScore: 0,
        criticalIssues: []
      },
      pages: [],
      bundleAnalysis: null,
      recommendations: []
    };
  }

  async runAudit() {
    console.log('‚ö° ÏÑ±Îä• ÏµúÏ†ÅÌôî Ï¢ÖÌï© Í≤ÄÏÇ¨ ÏãúÏûë...\n');

    // 1. ÌéòÏù¥ÏßÄÎ≥Ñ ÏÑ±Îä• Í≤ÄÏÇ¨
    await this.auditPages();

    // 2. Î≤àÎì§ Î∂ÑÏÑù
    await this.analyzeBundles();

    // 3. Í∂åÏû•ÏÇ¨Ìï≠ ÏÉùÏÑ±
    await this.generateRecommendations();

    // 4. Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ±
    await this.generateReport();

    // 5. Í≤∞Í≥º ÏöîÏïΩ
    this.printSummary();
  }

  async auditPages() {
    const browser = await chromium.launch({ headless: true });

    try {
      for (const page of PERFORMANCE_PAGES) {
        console.log(`üìä ${page.name} (${page.description}) ÏÑ±Îä• Í≤ÄÏÇ¨ Ï§ë...`);

        const pageResult = await this.auditPage(browser, page);
        this.results.pages.push(pageResult);

        // ÏÑ±Îä• Í∏∞Ï§Ä ÌÜµÍ≥º Ïó¨Î∂Ä ÌôïÏù∏
        const passed = this.checkPerformanceTargets(pageResult);
        if (passed) {
          this.results.summary.passedPages++;
          console.log(`‚úÖ ${page.name}: ÏÑ±Îä• Î™©Ìëú Îã¨ÏÑ±`);
        } else {
          this.results.summary.failedPages++;
          console.log(`‚ö†Ô∏è ${page.name}: ÏÑ±Îä• Í∞úÏÑ† ÌïÑÏöî`);
        }

        console.log('');
      }
    } finally {
      await browser.close();
    }
  }

  async auditPage(browser, pageInfo) {
    const context = await browser.newContext();
    const page = await context.newPage();

    try {
      // Navigation Timing APIÎ•º ÏúÑÌïú ÏãúÏûë ÏãúÏ†ê Í∏∞Î°ù
      await page.goto(pageInfo.url, { waitUntil: 'networkidle' });

      // ÌéòÏù¥ÏßÄ Î°úÎî© ÏÑ±Îä• Ï∏°Ï†ï
      const performanceMetrics = await page.evaluate(() => {
        const navigation = performance.getEntriesByType('navigation')[0];
        const paint = performance.getEntriesByType('paint');

        return {
          domContentLoaded: navigation.domContentLoadedEventEnd - navigation.domContentLoadedEventStart,
          loadComplete: navigation.loadEventEnd - navigation.loadEventStart,
          firstByte: navigation.responseStart - navigation.requestStart,
          firstContentfulPaint: paint.find(p => p.name === 'first-contentful-paint')?.startTime || 0,
          resourceCount: performance.getEntriesByType('resource').length,
          transferSize: performance.getEntriesByType('resource').reduce((total, resource) => total + (resource.transferSize || 0), 0)
        };
      });

      // Web Vitals Ï∏°Ï†ï (ÏãúÎÆ¨Î†àÏù¥ÏÖò)
      const webVitals = await this.measureWebVitals(page);

      // Í∞ÑÏÜåÌôîÎêú Lighthouse Ï†êÏàò Ï∂îÏ†ï
      const lighthouseScore = await this.estimateLighthouseScore(page, performanceMetrics);

      return {
        name: pageInfo.name,
        url: pageInfo.url,
        description: pageInfo.description,
        critical: pageInfo.critical,
        lighthouse: lighthouseScore,
        webVitals: webVitals,
        performance: performanceMetrics,
        timestamp: new Date().toISOString()
      };

    } catch (error) {
      console.error(`‚ùå ${pageInfo.name} ÏÑ±Îä• Í≤ÄÏÇ¨ Ï§ë Ïò§Î•ò:`, error.message);
      return {
        name: pageInfo.name,
        url: pageInfo.url,
        error: error.message,
        lighthouse: { performance: 0, accessibility: 0, bestPractices: 0, seo: 0 },
        webVitals: {},
        performance: {}
      };
    } finally {
      await context.close();
    }
  }

  async measureWebVitals(page) {
    return await page.evaluate(() => {
      return new Promise((resolve) => {
        // Ïã§Ï†ú ÌôòÍ≤ΩÏóêÏÑúÎäî web-vitals ÎùºÏù¥Î∏åÎü¨Î¶¨ ÏÇ¨Ïö©
        // Ïó¨Í∏∞ÏÑúÎäî Í∏∞Î≥∏Ï†ÅÏù∏ Ï∏°Ï†ïÏúºÎ°ú ÏãúÎÆ¨Î†àÏù¥ÏÖò
        setTimeout(() => {
          const navigation = performance.getEntriesByType('navigation')[0];
          const paint = performance.getEntriesByType('paint');

          resolve({
            LCP: paint.find(p => p.name === 'first-contentful-paint')?.startTime || 0,
            FID: 50, // ÏãúÎÆ¨Î†àÏù¥ÏÖò Í∞í
            CLS: 0.05, // ÏãúÎÆ¨Î†àÏù¥ÏÖò Í∞í
            FCP: paint.find(p => p.name === 'first-contentful-paint')?.startTime || 0,
            TTI: navigation.domContentLoadedEventEnd || 0
          });
        }, 1000);
      });
    });
  }

  async estimateLighthouseScore(page, metrics) {
    return await page.evaluate((metrics) => {
      let performanceScore = 100;
      let accessibilityScore = 100;
      let bestPracticesScore = 100;
      let seoScore = 100;

      // ÏÑ±Îä• Ï†êÏàò Í≥ÑÏÇ∞ (Í∞ÑÏÜåÌôî)
      if (metrics.firstContentfulPaint > 1800) performanceScore -= 20;
      if (metrics.domContentLoaded > 2000) performanceScore -= 15;
      if (metrics.transferSize > 1024 * 1024) performanceScore -= 10; // 1MB Ï¥àÍ≥ºÏãú

      // Ï†ëÍ∑ºÏÑ± Ï†êÏàò (Í∏∞Î≥∏ Ï≤¥ÌÅ¨)
      const images = document.querySelectorAll('img');
      const imagesWithoutAlt = Array.from(images).filter(img => !img.alt);
      accessibilityScore -= imagesWithoutAlt.length * 5;

      // SEO Ï†êÏàò (Í∏∞Î≥∏ Ï≤¥ÌÅ¨)
      if (!document.querySelector('meta[name="description"]')) seoScore -= 10;
      if (!document.querySelector('title') || document.title.length < 10) seoScore -= 15;

      // Î™®Î≤î ÏÇ¨Î°Ä Ï†êÏàò
      if (!document.querySelector('meta[name="viewport"]')) bestPracticesScore -= 10;
      if (location.protocol !== 'https:' && location.hostname !== 'localhost') bestPracticesScore -= 20;

      return {
        performance: Math.max(0, performanceScore),
        accessibility: Math.max(0, accessibilityScore),
        bestPractices: Math.max(0, bestPracticesScore),
        seo: Math.max(0, seoScore)
      };
    }, metrics);
  }

  checkPerformanceTargets(pageResult) {
    const targets = PERFORMANCE_TARGETS;

    // Lighthouse Ï†êÏàò ÌôïÏù∏
    if (pageResult.lighthouse.performance < targets.lighthouse.performance) return false;
    if (pageResult.lighthouse.accessibility < targets.lighthouse.accessibility) return false;

    // Web Vitals ÌôïÏù∏
    if (pageResult.webVitals.LCP > targets.webVitals.LCP) return false;
    if (pageResult.webVitals.FID > targets.webVitals.FID) return false;
    if (pageResult.webVitals.CLS > targets.webVitals.CLS) return false;

    // ÌéòÏù¥ÏßÄ Î°úÎî© ÏãúÍ∞Ñ ÌôïÏù∏
    if (pageResult.performance.domContentLoaded > targets.pageLoad.domContentLoaded) return false;
    if (pageResult.performance.firstByte > targets.pageLoad.firstByte) return false;

    return true;
  }

  async analyzeBundles() {
    console.log('üì¶ Î≤àÎì§ ÌÅ¨Í∏∞ Î∂ÑÏÑù Ï§ë...');

    try {
      // .next/static Ìè¥Îçî Î∂ÑÏÑù
      const staticDir = path.join(process.cwd(), '.next/static');
      if (!fs.existsSync(staticDir)) {
        console.log('‚ö†Ô∏è ÎπåÎìú ÌååÏùºÏù¥ ÏóÜÏäµÎãàÎã§. npm run buildÎ•º Î®ºÏ†Ä Ïã§ÌñâÌïòÏÑ∏Ïöî.');
        return;
      }

      const bundleInfo = await this.analyzeBundleSize(staticDir);
      this.results.bundleAnalysis = bundleInfo;

      console.log(`‚úÖ Î≤àÎì§ Î∂ÑÏÑù ÏôÑÎ£å: ${bundleInfo.totalSize}KB`);
    } catch (error) {
      console.error('‚ùå Î≤àÎì§ Î∂ÑÏÑù Ïã§Ìå®:', error.message);
    }
  }

  async analyzeBundleSize(staticDir) {
    const chunks = path.join(staticDir, 'chunks');
    const css = path.join(staticDir, 'css');

    let totalSize = 0;
    const files = [];

    // JavaScript Ï≤≠ÌÅ¨ Î∂ÑÏÑù
    if (fs.existsSync(chunks)) {
      const jsFiles = fs.readdirSync(chunks).filter(file => file.endsWith('.js'));
      for (const file of jsFiles) {
        const filePath = path.join(chunks, file);
        const stats = fs.statSync(filePath);
        const sizeKB = Math.round(stats.size / 1024);
        totalSize += sizeKB;
        files.push({ name: file, type: 'JavaScript', size: sizeKB });
      }
    }

    // CSS ÌååÏùº Î∂ÑÏÑù
    if (fs.existsSync(css)) {
      const cssFiles = fs.readdirSync(css).filter(file => file.endsWith('.css'));
      for (const file of cssFiles) {
        const filePath = path.join(css, file);
        const stats = fs.statSync(filePath);
        const sizeKB = Math.round(stats.size / 1024);
        totalSize += sizeKB;
        files.push({ name: file, type: 'CSS', size: sizeKB });
      }
    }

    return {
      totalSize,
      files: files.sort((a, b) => b.size - a.size),
      largestFiles: files.slice(0, 10)
    };
  }

  async generateRecommendations() {
    const recommendations = [];

    // Lighthouse Ï†êÏàò Í∏∞Î∞ò Í∂åÏû•ÏÇ¨Ìï≠
    this.results.pages.forEach(page => {
      if (page.lighthouse.performance < PERFORMANCE_TARGETS.lighthouse.performance) {
        recommendations.push({
          priority: 'High',
          category: 'Performance',
          page: page.name,
          issue: `Lighthouse ÏÑ±Îä• Ï†êÏàò ${page.lighthouse.performance} (Î™©Ìëú: ${PERFORMANCE_TARGETS.lighthouse.performance})`,
          solution: 'Ïù¥ÎØ∏ÏßÄ ÏµúÏ†ÅÌôî, ÏΩîÎìú Ïä§ÌîåÎ¶¨ÌåÖ, Ï∫êÏã± Í∞úÏÑ†'
        });
      }

      if (page.webVitals.LCP > PERFORMANCE_TARGETS.webVitals.LCP) {
        recommendations.push({
          priority: 'High',
          category: 'Web Vitals',
          page: page.name,
          issue: `LCP ${Math.round(page.webVitals.LCP)}ms (Î™©Ìëú: ${PERFORMANCE_TARGETS.webVitals.LCP}ms)`,
          solution: 'Î©îÏù∏ ÏΩòÌÖêÏ∏† Î°úÎî© ÏÜçÎèÑ Í∞úÏÑ†, Ïù¥ÎØ∏ÏßÄ ÌîÑÎ¶¨Î°úÎî©'
        });
      }
    });

    // Î≤àÎì§ ÌÅ¨Í∏∞ Í∏∞Î∞ò Í∂åÏû•ÏÇ¨Ìï≠
    if (this.results.bundleAnalysis && this.results.bundleAnalysis.totalSize > 500) {
      recommendations.push({
        priority: 'Medium',
        category: 'Bundle Size',
        page: 'All',
        issue: `Ï¥ù Î≤àÎì§ ÌÅ¨Í∏∞ ${this.results.bundleAnalysis.totalSize}KB (Í∂åÏû•: 500KB Ïù¥Ìïò)`,
        solution: 'Ìä∏Î¶¨ ÏâêÏù¥ÌÇπ, ÎèôÏ†Å ÏûÑÌè¨Ìä∏, Î∂àÌïÑÏöîÌïú ÎùºÏù¥Î∏åÎü¨Î¶¨ Ï†úÍ±∞'
      });
    }

    this.results.recommendations = recommendations;
  }

  async generateReport() {
    const reportDir = path.join(process.cwd(), 'reports');
    if (!fs.existsSync(reportDir)) {
      fs.mkdirSync(reportDir, { recursive: true });
    }

    // JSON Î¶¨Ìè¨Ìä∏
    const jsonReport = path.join(reportDir, 'performance-audit.json');
    fs.writeFileSync(jsonReport, JSON.stringify(this.results, null, 2));

    // HTML Î¶¨Ìè¨Ìä∏
    const htmlReport = path.join(reportDir, 'performance-audit.html');
    const htmlContent = this.generateHTMLReport();
    fs.writeFileSync(htmlReport, htmlContent);

    console.log(`üìä ÏÑ±Îä• Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ± ÏôÑÎ£å:`);
    console.log(`   JSON: ${jsonReport}`);
    console.log(`   HTML: ${htmlReport}\n`);
  }

  generateHTMLReport() {
    const avgPerformance = Math.round(
      this.results.pages.reduce((sum, page) => sum + page.lighthouse.performance, 0) / this.results.pages.length
    );

    return `
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏÑ±Îä• ÏµúÏ†ÅÌôî Í≤ÄÏ¶ù Î¶¨Ìè¨Ìä∏</title>
    <style>
        body { font-family: system-ui, sans-serif; margin: 40px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 40px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header { border-bottom: 2px solid #e5e5e5; padding-bottom: 20px; margin-bottom: 30px; }
        .summary { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .metric { padding: 20px; background: #f8f9fa; border-radius: 6px; text-align: center; }
        .metric-value { font-size: 2em; font-weight: bold; margin-bottom: 5px; }
        .good { color: #28a745; }
        .warning { color: #ffc107; }
        .poor { color: #dc3545; }
        .page-result { margin-bottom: 30px; border: 1px solid #dee2e6; border-radius: 6px; overflow: hidden; }
        .page-header { background: #343a40; color: white; padding: 15px; }
        .scores { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin: 20px 0; }
        .score { text-align: center; padding: 15px; background: #f8f9fa; border-radius: 4px; }
        .vitals { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin: 20px 0; }
        .bundle-analysis { background: #e3f2fd; padding: 20px; border-radius: 6px; margin: 20px 0; }
        .recommendations { background: #fff3e0; padding: 20px; border-radius: 6px; margin-top: 30px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>‚ö° ÏÑ±Îä• ÏµúÏ†ÅÌôî Í≤ÄÏ¶ù Î¶¨Ìè¨Ìä∏</h1>
            <p>ÏÉùÏÑ± ÏãúÍ∞Ñ: ${this.results.timestamp}</p>
            <p>Î≤†Ìä∏ÎÇ® K-Connect MVP ÏÑ±Îä• Î™©Ìëú Îã¨ÏÑ± Í≤ÄÏ¶ù</p>
        </div>

        <div class="summary">
            <div class="metric">
                <div class="metric-value">${avgPerformance}</div>
                <div>ÌèâÍ∑† ÏÑ±Îä• Ï†êÏàò</div>
            </div>
            <div class="metric">
                <div class="metric-value ${this.results.summary.passedPages === this.results.summary.totalPages ? 'good' : 'warning'}">${this.results.summary.passedPages}/${this.results.summary.totalPages}</div>
                <div>ÌÜµÍ≥ºÌïú ÌéòÏù¥ÏßÄ</div>
            </div>
            <div class="metric">
                <div class="metric-value">${this.results.bundleAnalysis?.totalSize || 0}KB</div>
                <div>Ï¥ù Î≤àÎì§ ÌÅ¨Í∏∞</div>
            </div>
            <div class="metric">
                <div class="metric-value ${this.results.recommendations.length === 0 ? 'good' : 'warning'}">${this.results.recommendations.length}</div>
                <div>Í∞úÏÑ† Í∂åÏû•ÏÇ¨Ìï≠</div>
            </div>
        </div>

        <h2>üìÑ ÌéòÏù¥ÏßÄÎ≥Ñ ÏÑ±Îä• Í≤∞Í≥º</h2>
        ${this.results.pages.map(page => `
            <div class="page-result">
                <div class="page-header">
                    <h3>${page.name} - ${page.description}</h3>
                    <p>URL: ${page.url} ${page.critical ? '(ÌïµÏã¨ ÌéòÏù¥ÏßÄ)' : ''}</p>
                </div>
                <div style="padding: 20px;">
                    <h4>Lighthouse Ï†êÏàò</h4>
                    <div class="scores">
                        <div class="score">
                            <div class="metric-value ${page.lighthouse.performance >= 90 ? 'good' : page.lighthouse.performance >= 70 ? 'warning' : 'poor'}">${page.lighthouse.performance}</div>
                            <div>ÏÑ±Îä•</div>
                        </div>
                        <div class="score">
                            <div class="metric-value ${page.lighthouse.accessibility >= 95 ? 'good' : page.lighthouse.accessibility >= 80 ? 'warning' : 'poor'}">${page.lighthouse.accessibility}</div>
                            <div>Ï†ëÍ∑ºÏÑ±</div>
                        </div>
                        <div class="score">
                            <div class="metric-value ${page.lighthouse.bestPractices >= 90 ? 'good' : page.lighthouse.bestPractices >= 70 ? 'warning' : 'poor'}">${page.lighthouse.bestPractices}</div>
                            <div>Î™®Î≤îÏÇ¨Î°Ä</div>
                        </div>
                        <div class="score">
                            <div class="metric-value ${page.lighthouse.seo >= 85 ? 'good' : page.lighthouse.seo >= 70 ? 'warning' : 'poor'}">${page.lighthouse.seo}</div>
                            <div>SEO</div>
                        </div>
                    </div>

                    <h4>Web Vitals</h4>
                    <div class="vitals">
                        <div class="score">
                            <div class="metric-value ${page.webVitals.LCP <= 2500 ? 'good' : page.webVitals.LCP <= 4000 ? 'warning' : 'poor'}">${Math.round(page.webVitals.LCP || 0)}ms</div>
                            <div>LCP</div>
                        </div>
                        <div class="score">
                            <div class="metric-value ${page.webVitals.FID <= 100 ? 'good' : page.webVitals.FID <= 300 ? 'warning' : 'poor'}">${Math.round(page.webVitals.FID || 0)}ms</div>
                            <div>FID</div>
                        </div>
                        <div class="score">
                            <div class="metric-value ${page.webVitals.CLS <= 0.1 ? 'good' : page.webVitals.CLS <= 0.25 ? 'warning' : 'poor'}">${(page.webVitals.CLS || 0).toFixed(2)}</div>
                            <div>CLS</div>
                        </div>
                        <div class="score">
                            <div class="metric-value ${page.webVitals.FCP <= 1800 ? 'good' : page.webVitals.FCP <= 3000 ? 'warning' : 'poor'}">${Math.round(page.webVitals.FCP || 0)}ms</div>
                            <div>FCP</div>
                        </div>
                    </div>
                </div>
            </div>
        `).join('')}

        ${this.results.bundleAnalysis ? `
            <div class="bundle-analysis">
                <h2>üì¶ Î≤àÎì§ Î∂ÑÏÑù</h2>
                <p><strong>Ï¥ù ÌÅ¨Í∏∞:</strong> ${this.results.bundleAnalysis.totalSize}KB</p>
                <h4>ÌÅ∞ ÌååÏùº Top 10:</h4>
                <ul>
                    ${this.results.bundleAnalysis.largestFiles.map(file =>
                        `<li>${file.name} (${file.type}): ${file.size}KB</li>`
                    ).join('')}
                </ul>
            </div>
        ` : ''}

        ${this.results.recommendations.length > 0 ? `
            <div class="recommendations">
                <h2>üéØ ÏÑ±Îä• Í∞úÏÑ† Í∂åÏû•ÏÇ¨Ìï≠</h2>
                ${this.results.recommendations.map(rec => `
                    <div style="margin-bottom: 15px; padding: 15px; background: white; border-radius: 4px; border-left: 4px solid ${rec.priority === 'High' ? '#dc3545' : rec.priority === 'Medium' ? '#ffc107' : '#28a745'};">
                        <h4>[${rec.priority}] ${rec.category} - ${rec.page}</h4>
                        <p><strong>Î¨∏Ï†ú:</strong> ${rec.issue}</p>
                        <p><strong>Ìï¥Í≤∞Î∞©Ïïà:</strong> ${rec.solution}</p>
                    </div>
                `).join('')}
            </div>
        ` : ''}
    </div>
</body>
</html>
    `;
  }

  printSummary() {
    console.log('üìä ÏÑ±Îä• ÏµúÏ†ÅÌôî Í≤ÄÏ¶ù Í≤∞Í≥º ÏöîÏïΩ');
    console.log('='.repeat(50));
    console.log(`Ï¥ù Í≤ÄÏÇ¨ ÌéòÏù¥ÏßÄ: ${this.results.summary.totalPages}Í∞ú`);
    console.log(`ÏÑ±Îä• Î™©Ìëú Îã¨ÏÑ±: ${this.results.summary.passedPages}Í∞ú`);
    console.log(`Í∞úÏÑ† ÌïÑÏöî: ${this.results.summary.failedPages}Í∞ú`);

    const avgPerformance = Math.round(
      this.results.pages.reduce((sum, page) => sum + page.lighthouse.performance, 0) / this.results.pages.length
    );
    console.log(`ÌèâÍ∑† ÏÑ±Îä• Ï†êÏàò: ${avgPerformance}/100`);

    if (this.results.bundleAnalysis) {
      console.log(`Ï¥ù Î≤àÎì§ ÌÅ¨Í∏∞: ${this.results.bundleAnalysis.totalSize}KB`);
    }

    console.log(`Í∞úÏÑ† Í∂åÏû•ÏÇ¨Ìï≠: ${this.results.recommendations.length}Í∞ú`);

    if (this.results.summary.failedPages === 0) {
      console.log('\nüéâ Ï∂ïÌïòÌï©ÎãàÎã§! Î™®Îì† ÌéòÏù¥ÏßÄÍ∞Ä ÏÑ±Îä• Î™©ÌëúÎ•º Îã¨ÏÑ±ÌñàÏäµÎãàÎã§.');
    } else {
      console.log('\n‚ö†Ô∏è  ÏÑ±Îä• Í∞úÏÑ†Ïù¥ ÌïÑÏöîÌïú ÌéòÏù¥ÏßÄÍ∞Ä ÏûàÏäµÎãàÎã§. Î¶¨Ìè¨Ìä∏Î•º ÌôïÏù∏ÌïòÏÑ∏Ïöî.');
    }
  }
}

// Ïä§ÌÅ¨Î¶ΩÌä∏ Ïã§Ìñâ
async function main() {
  try {
    const auditor = new PerformanceAuditor();
    await auditor.runAudit();
  } catch (error) {
    console.error('‚ùå ÏÑ±Îä• Í≤ÄÏ¶ù Ï§ë Ïò§Î•ò Î∞úÏÉù:', error);
    process.exit(1);
  }
}

if (require.main === module) {
  main();
}

module.exports = PerformanceAuditor;