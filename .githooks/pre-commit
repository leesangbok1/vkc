#!/bin/bash

# íŒŒì¼ ìë™ ì •ë¦¬ pre-commit hook

echo "ğŸ” Pre-commit: í”„ë¡œì íŠ¸ êµ¬ì¡° ê²€ì¦ ì¤‘..."

# í”„ë¡œì íŠ¸ êµ¬ì¡° ê²€ì¦
node scripts/simple-validator.cjs full

if [ $? -ne 0 ]; then
    echo "âŒ í”„ë¡œì íŠ¸ êµ¬ì¡° ê²€ì¦ ì‹¤íŒ¨!"
    echo "ğŸ’¡ ìˆ˜ì • í›„ ë‹¤ì‹œ ì»¤ë°‹í•˜ê±°ë‚˜ --no-verify ì˜µì…˜ì„ ì‚¬ìš©í•˜ì„¸ìš”."
    exit 1
fi

# ìŠ¤í…Œì´ì§•ëœ íŒŒì¼ë“¤ ì¤‘ ì˜ëª»ëœ ìœ„ì¹˜ì˜ íŒŒì¼ í™•ì¸
STAGED_FILES=$(git diff --cached --name-only)

for file in $STAGED_FILES; do
    if [[ -f "$file" ]]; then
        # JavaScript/JSX íŒŒì¼ ì²´í¬
        if [[ "$file" =~ \.(js|jsx)$ ]]; then
            # ì»´í¬ë„ŒíŠ¸ íŒŒì¼ì´ src/componentsì— ìˆëŠ”ì§€ í™•ì¸
            if [[ "$file" =~ [A-Z].*\.jsx$ ]] && [[ ! "$file" =~ ^src/components/ ]]; then
                echo "âš ï¸  ì˜ëª»ëœ ìœ„ì¹˜ì˜ ì»´í¬ë„ŒíŠ¸ íŒŒì¼: $file"
                echo "   src/components/ ì•„ë˜ì— ìœ„ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤."

                # ìë™ ì •ë¦¬ ì œì•ˆ
                echo "ğŸ’¡ ìë™ ì •ë¦¬ë¥¼ ì‹¤í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/n)"
                read -r response
                if [[ "$response" =~ ^[Yy]$ ]]; then
                    node scripts/file-organizer.cjs scan
                    echo "âœ… íŒŒì¼ ìë™ ì •ë¦¬ ì™„ë£Œ. ë³€ê²½ì‚¬í•­ì„ ë‹¤ì‹œ ìŠ¤í…Œì´ì§•í•˜ì„¸ìš”."
                    exit 1
                fi
            fi
        fi
    fi
done

echo "âœ… Pre-commit ê²€ì¦ í†µê³¼!"
exit 0