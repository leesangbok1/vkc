#!/bin/bash

# 파일 자동 정리 pre-commit hook

echo "🔍 Pre-commit: 프로젝트 구조 검증 중..."

# 프로젝트 구조 검증
node scripts/simple-validator.cjs full

if [ $? -ne 0 ]; then
    echo "❌ 프로젝트 구조 검증 실패!"
    echo "💡 수정 후 다시 커밋하거나 --no-verify 옵션을 사용하세요."
    exit 1
fi

# 스테이징된 파일들 중 잘못된 위치의 파일 확인
STAGED_FILES=$(git diff --cached --name-only)

for file in $STAGED_FILES; do
    if [[ -f "$file" ]]; then
        # JavaScript/JSX 파일 체크
        if [[ "$file" =~ \.(js|jsx)$ ]]; then
            # 컴포넌트 파일이 src/components에 있는지 확인
            if [[ "$file" =~ [A-Z].*\.jsx$ ]] && [[ ! "$file" =~ ^src/components/ ]]; then
                echo "⚠️  잘못된 위치의 컴포넌트 파일: $file"
                echo "   src/components/ 아래에 위치해야 합니다."

                # 자동 정리 제안
                echo "💡 자동 정리를 실행하시겠습니까? (y/n)"
                read -r response
                if [[ "$response" =~ ^[Yy]$ ]]; then
                    node scripts/file-organizer.cjs scan
                    echo "✅ 파일 자동 정리 완료. 변경사항을 다시 스테이징하세요."
                    exit 1
                fi
            fi
        fi
    fi
done

echo "✅ Pre-commit 검증 통과!"
exit 0